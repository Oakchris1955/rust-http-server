<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Request handlers - Oak HTTP server tutorial</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Getting started</li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li class="chapter-item expanded "><a href="minimal-example.html"><strong aria-hidden="true">3.</strong> Minimal example</a></li><li class="chapter-item expanded affix "><li class="part-title">Advanced usage</li><li class="chapter-item expanded "><a href="http-protocol.html"><strong aria-hidden="true">4.</strong> About the HTTP protocol</a></li><li class="chapter-item expanded "><a href="request-handlers.html" class="active"><strong aria-hidden="true">5.</strong> Request handlers</a></li><li class="chapter-item expanded "><a href="request-response-structs.html"><strong aria-hidden="true">6.</strong> The Request and Response structs</a></li><li class="chapter-item expanded "><a href="generic-data-structures.html"><strong aria-hidden="true">7.</strong> Other important data structures</a></li><li class="chapter-item expanded affix "><li class="part-title">Library modules</li><li class="chapter-item expanded "><a href="modules-introduction.html"><strong aria-hidden="true">8.</strong> What are they?</a></li><li class="chapter-item expanded "><a href="handlers-module.html"><strong aria-hidden="true">9.</strong> Handlers</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Oak HTTP server tutorial</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="request-handlers"><a class="header" href="#request-handlers">Request handlers</a></h1>
<p>So far we have learned what a HTTP server is capable of, but how exactly do we program one using this library? In this chapter, you will learn how to write custom request handlers and how to use some that the library already provides.</p>
<h2 id="the-handler-concept"><a class="header" href="#the-handler-concept">The handler concept</a></h2>
<p>The usage concept of this library is centered around simplicity: this library shouldn't be pretty complicated in terms of design, but it should also provide broad control to the end user over the HTTP connection.</p>
<p>In order to achieve this, the way the library is built gives full control to the user over a HTTP request and the corresponding response (in the case the request isn't malformed by the user, of course. In that case, the connection is dropped before the user gets the chance to handle the connection)</p>
<h2 id="what-is-a-handler-anyways"><a class="header" href="#what-is-a-handler-anyways">What is a handler anyways?</a></h2>
<p>As defined in <code>lib.rs</code>, the type <code>HandlerCallback</code> is a dynamically dispacted <code>Fn(Request, Response)</code>, where <code>Request</code> and <code>Response</code> and the request and response structs correspondingly. What this basically means is that any function whose has 2 arguments, the first one of which is a <code>Request</code> and the second one a <code>Response</code> is a valid <code>HandlerCallback</code></p>
<p>For example, the following function falls under the aforementioned criteria:</p>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">extern crate oak_http_server;
</span><span class="boring">use oak_http_server::{Request, Response, Server};
</span><span class="boring">
</span>fn example_handler_func(_request: Request, response: Response) {
    // This handler responds to the HTTP request with a predefined string
    response.end_with(&quot;I am a concrete function handler!!!&quot;);
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let example_handler_closure = |_request: Request, response: Response| {
</span><span class="boring">        // This handler responds to the HTTP request with a predefined string
</span><span class="boring">        response.end_with(&quot;And I am a closure!!!&quot;);
</span><span class="boring">    };
</span><span class="boring">
</span><span class="boring">    let hostname = &quot;localhost&quot;;
</span><span class="boring">    let port: u16 = 2300;
</span><span class="boring">
</span><span class="boring">    // Create a Server instance
</span><span class="boring">    let mut server = Server::new(hostname, port);
</span><span class="boring">
</span><span class="boring">    // Append generic function handler
</span><span class="boring">    server.on(&quot;/function&quot;, example_handler_func);
</span><span class="boring">
</span><span class="boring">    // Append closure handler that responds only to `GET` requests
</span><span class="boring">    server.on_get(&quot;/closure&quot;, example_handler_closure);
</span><span class="boring">
</span><span class="boring">    // Start the HTTP server
</span><span class="boring">    server.start(|| {
</span><span class="boring">        println!(&quot;HTTP server is now running...&quot;);
</span><span class="boring">    });
</span><span class="boring">}
</span></code></pre></pre>
<p>Since our handler is a <code>Fn</code> trait and not a concrete <code>fn</code> type, we call also pass closures as handlers. The following closure is also a valid handler</p>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">extern crate oak_http_server;
</span><span class="boring">use oak_http_server::{Request, Response, Server};
</span><span class="boring">
</span><span class="boring">fn example_handler_func(_request: Request, response: Response) {
</span><span class="boring">    // This handler responds to the HTTP request with a predefined string
</span><span class="boring">    response.end_with(&quot;I am a concrete function handler!!!&quot;);
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">fn main() {
</span>    let example_handler_closure = |_request: Request, response: Response| {
        // This handler responds to the HTTP request with a predefined string
        response.end_with(&quot;And I am a closure!!!&quot;);
    };
<span class="boring">
</span><span class="boring">    let hostname = &quot;localhost&quot;;
</span><span class="boring">    let port: u16 = 2300;
</span><span class="boring">
</span><span class="boring">    // Create a Server instance
</span><span class="boring">    let mut server = Server::new(hostname, port);
</span><span class="boring">
</span><span class="boring">    // Append generic function handler
</span><span class="boring">    server.on(&quot;/function&quot;, example_handler_func);
</span><span class="boring">
</span><span class="boring">    // Append closure handler that responds only to `GET` requests
</span><span class="boring">    server.on_get(&quot;/closure&quot;, example_handler_closure);
</span><span class="boring">
</span><span class="boring">    // Start the HTTP server
</span><span class="boring">    server.start(|| {
</span><span class="boring">        println!(&quot;HTTP server is now running...&quot;);
</span><span class="boring">    });
</span><span class="boring">}
</span></code></pre></pre>
<h2 id="appending-handlers"><a class="header" href="#appending-handlers">Appending handlers</a></h2>
<p>So far we've seen how to create a handler, but we also must let the <code>Server</code> struct know of them. Before checking how this is done, let's check at the different types of request handlers, as defined in <code>lib.rs</code>:</p>
<ol>
<li><code>Any</code>: This handler will be executed on any requested at the specified target</li>
<li><code>Specific</code>: This handler will be executed only on requests made using a specific HTTP method (<code>GET</code>, <code>POST</code>, etc) at the specified target</li>
<li><code>Directory</code>: This handler type requires a seperate chapter on its own and won't be covered here. All you need to know is that it is called not in just one target, but multiple that fall under the same path (a <code>Directory</code> handler attached at <code>/foo</code> will be called on <code>/foo/etc</code>, <code>/foo/some</code> and so on)</li>
</ol>
<p>The <code>Server</code> struct provides us with some methods in order to attach handlers. These are the following:</p>
<ol>
<li><code>Server::on()</code> to attach generic <code>Any</code> handlers</li>
<li><code>Server::on_METHOD()</code> to attach handler for a specific <code>METHOD</code> (for example, <code>on_get</code> attaches a <code>Specific</code> <code>GET</code> handler)</li>
<li><code>Server::on_directory()</code> to attach a <code>Directory</code> handler</li>
</ol>
<p>All the above function have the same function signature: that means that all of them take a <code>&amp;str</code> or <code>String</code> as the target argument and a <code>HandlerCallback</code> as the second argument</p>
<p>Let's attach those handlers to our server now:</p>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">extern crate oak_http_server;
</span>use oak_http_server::{Request, Response, Server};

fn example_handler_func(_request: Request, response: Response) {
    // This handler responds to the HTTP request with a predefined string
    response.end_with(&quot;I am a concrete function handler!!!&quot;);
}

fn main() {
    let example_handler_closure = |_request: Request, response: Response| {
        // This handler responds to the HTTP request with a predefined string
        response.end_with(&quot;And I am a closure!!!&quot;);
    };

    let hostname = &quot;localhost&quot;;
    let port: u16 = 2300;

    // Create a Server instance
    let mut server = Server::new(hostname, port);

    // Append generic function handler
    server.on(&quot;/function&quot;, example_handler_func);

    // Append closure handler that responds only to `GET` requests
    server.on_get(&quot;/closure&quot;, example_handler_closure);

    // Start the HTTP server
    server.start(|| {
        println!(&quot;HTTP server is now running...&quot;);
    });
}
</code></pre></pre>
<p>Similarly, you can create your own handlers. With this library, the sky's the limit to what you can do.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="http-protocol.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="request-response-structs.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="http-protocol.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="request-response-structs.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
